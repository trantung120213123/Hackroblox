-- GUI Script by Tien Tung (ngá»‘) - ULTIMATE VERSION WITH RANDOM TARGET
loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
   Name = "ðŸ† Auto Sword ULTIMATE",
   LoadingTitle = "Auto Sword ULTIMATE - Red vs Blue",
   LoadingSubtitle = "by Tien Tung | Random Target Selection",
   ConfigurationSaving = {
      Enabled = false
   },
   Discord = {
      Enabled = false,
   },
   KeySystem = false,
})

local PlaneTab = Window:CreateTab("Chiáº¿n Äáº¥u", 4483362458)
local AutoKillRunning = false
local Team = game.Players.LocalPlayer.Team
local CurrentTarget = nil

-- Cáº¥u hÃ¬nh
local SETTINGS = {
    TP_INTERVAL = 0.05,
    TP_DISTANCE = 2,
    HITBOX_RANGE = 20,
    ATTACK_DELAY = 0.1,
    TARGET_CHANGE_INTERVAL = 5 -- Thay Ä‘á»•i má»¥c tiÃªu má»—i 5 giÃ¢y
}

-- TÃ¬m kiáº¿m kiáº¿m trong tÃºi Ä‘á»“ vÃ  trÃªn ngÆ°á»i
local function findSword()
    for _, container in ipairs({game.Players.LocalPlayer.Character, game.Players.LocalPlayer.Backpack}) do
        if container then
            for _, tool in ipairs(container:GetChildren()) do
                if tool:IsA("Tool") and (tool.Name:lower():find("sword") or tool.Name:lower():find("kiáº¿m") or tool.Name:lower():find("katana") or tool.Name:lower():find("blade")) then
                    return tool
                end
            end
        end
    end
    return nil
end

-- Tá»± Ä‘á»™ng cáº§m kiáº¿m náº¿u chÆ°a cáº§m
local function equipSword()
    local sword = findSword()
    if sword and sword.Parent ~= game.Players.LocalPlayer.Character then
        sword.Parent = game.Players.LocalPlayer.Character
        return true
    end
    return sword ~= nil
end

-- TÃ¬m káº» Ä‘á»‹ch ngáº«u nhiÃªn trong team Ä‘á»‹ch (ÄÃƒ Sá»¬A)
local function getRandomEnemy()
    local validEnemies = {}
    
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Team ~= Team and player.Character then
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
            
            if humanoid and humanoid.Health > 0 and rootPart then
                table.insert(validEnemies, player.Character)
            end
        end
    end
    
    if #validEnemies > 0 then
        return validEnemies[math.random(1, #validEnemies)]
    end
    return nil
end

-- VÃ²ng láº·p chiáº¿n Ä‘áº¥u chÃ­nh (ÄÃƒ Cáº¬P NHáº¬T)
local function combatLoop()
    local lastTargetChange = 0
    
    while AutoKillRunning do
        -- Kiá»ƒm tra nhÃ¢n váº­t
        local char = game.Players.LocalPlayer.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then
            task.wait(0.5)
            continue
        end

        -- Tá»± Ä‘á»™ng cáº§m kiáº¿m
        if not equipSword() then
            task.wait(1)
            continue
        end

        -- Äá»•i má»¥c tiÃªu theo Ä‘á»‹nh ká»³ hoáº·c náº¿u má»¥c tiÃªu hiá»‡n táº¡i khÃ´ng há»£p lá»‡
        if tick() - lastTargetChange > SETTINGS.TARGET_CHANGE_INTERVAL or 
           not CurrentTarget or 
           not CurrentTarget.Parent or 
           not CurrentTarget:FindFirstChild("HumanoidRootPart") or 
           CurrentTarget.Humanoid.Health <= 0 then
            
            CurrentTarget = getRandomEnemy()
            lastTargetChange = tick()
            
            if CurrentTarget then
                Rayfield:Notify({
                    Title = "ðŸŽ¯ Má»¤C TIÃŠU Má»šI",
                    Content = "ÄÃ£ chá»n ngÆ°á»i chÆ¡i ngáº«u nhiÃªn",
                    Duration = 1,
                })
            else
                task.wait(1)
                continue
            end
        end

        -- Thá»±c hiá»‡n TP vÃ  táº¥n cÃ´ng
        if CurrentTarget and CurrentTarget:FindFirstChild("HumanoidRootPart") then
            local targetHRP = CurrentTarget.HumanoidRootPart
            local myHRP = char.HumanoidRootPart
            
            -- TP Ä‘áº¿n phÃ­a sau Ä‘á»‹ch vÃ  hÆ°á»›ng máº·t vÃ o Ä‘á»‹ch
            local backPosition = targetHRP.Position - (targetHRP.CFrame.LookVector * SETTINGS.TP_DISTANCE)
            myHRP.CFrame = CFrame.new(backPosition, targetHRP.Position)
            
            -- Táº¡o hitbox má»Ÿ rá»™ng
            local fakeHitbox = Instance.new("Part")
            fakeHitbox.Size = Vector3.new(SETTINGS.HITBOX_RANGE, SETTINGS.HITBOX_RANGE, SETTINGS.HITBOX_RANGE)
            fakeHitbox.Transparency = 1
            fakeHitbox.CanCollide = false
            fakeHitbox.Anchored = true
            fakeHitbox.Position = targetHRP.Position
            fakeHitbox.Parent = workspace
            
            -- Táº¥n cÃ´ng
            local sword = char:FindFirstChildOfClass("Tool")
            if sword then
                for _ = 1, 3 do
                    sword:Activate()
                    task.wait(SETTINGS.ATTACK_DELAY)
                end
            end
            
            -- XÃ³a hitbox
            fakeHitbox:Destroy()
        end
        
        task.wait(SETTINGS.TP_INTERVAL)
    end
end

-- NÃºt báº­t/táº¯t
local toggleState = false
local ToggleBtn = PlaneTab:CreateButton({
    Name = "âš”ï¸ Báº¬T/Táº®T AUTO KIáº¾M",
    Callback = function()
        toggleState = not toggleState
        AutoKillRunning = toggleState
        
        if toggleState then
            Team = game.Players.LocalPlayer.Team
            if not findSword() then
                Rayfield:Notify({
                    Title = "âŒ KHÃ”NG CÃ“ KIáº¾M",
                    Content = "Vui lÃ²ng trang bá»‹ kiáº¿m trÆ°á»›c!",
                    Duration = 3,
                })
                toggleState = false
                AutoKillRunning = false
                return
            end
            
            Rayfield:Notify({
                Title = "âš”ï¸ ÄÃƒ Báº¬T",
                Content = "Äang táº¥n cÃ´ng ngáº«u nhiÃªn team Ä‘á»‹ch",
                Duration = 2,
            })
            coroutine.wrap(combatLoop)()
        else
            CurrentTarget = nil
            Rayfield:Notify({
                Title = "ÄÃƒ Táº®T",
                Content = "Auto Sword Ä‘Ã£ dá»«ng",
                Duration = 1.5,
            })
        end
    end
})

-- Tab thÃ´ng tin (Ä‘Ã£ cáº­p nháº­t)
local InfoTab = Window:CreateTab("ThÃ´ng Tin", 7733960981)
InfoTab:CreateLabel("CÃ¡ch hoáº¡t Ä‘á»™ng:")
InfoTab:CreateLabel("- Tá»± Ä‘á»™ng chá»n NGáºªU NHIÃŠN má»¥c tiÃªu trong team Ä‘á»‹ch")
InfoTab:CreateLabel("- Thay Ä‘á»•i má»¥c tiÃªu má»—i "..SETTINGS.TARGET_CHANGE_INTERVAL.." giÃ¢y")
InfoTab:CreateLabel("- TP sau lÆ°ng Ä‘á»‹ch + hitbox "..SETTINGS.HITBOX_RANGE.." studs")
InfoTab:CreateLabel("- Tá»± Ä‘á»™ng cáº§m kiáº¿m khi cáº§n")
InfoTab:CreateLabel("- Chá» Ä‘á»‹ch náº¿u khÃ´ng cÃ³ má»¥c tiÃªu há»£p lá»‡")

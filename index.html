<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gia Sư Toán AI - Giải Toán & Tìm X</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(90deg, #3a7bd5, #00d2ff);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 85%;
            padding: 15px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            position: relative;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background: white;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            border: 1px solid #eee;
        }
        
        .input-container {
            display: flex;
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
        }
        
        .input-container input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .input-container input:focus {
            border-color: #3a7bd5;
            box-shadow: 0 0 0 3px rgba(58, 123, 213, 0.2);
        }
        
        .input-container button {
            background: linear-gradient(90deg, #3a7bd5, #00d2ff);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .input-container button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: none;
        }
        
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background: #3a7bd5;
            border-radius: 50%;
            margin: 0 2px;
            display: inline-block;
            animation: typing 1s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }
        
        .solution-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #3a7bd5;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .solution-step {
            margin-bottom: 10px;
            padding-left: 15px;
            position: relative;
        }
        
        .solution-step:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #3a7bd5;
        }
        
        .final-result {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
            border-left: 4px solid #3a7bd5;
        }
        
        .level-indicator {
            font-size: 0.8rem;
            background: #e0e7ff;
            color: #4f46e5;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 8px;
        }
        
        .welcome-message {
            text-align: center;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 15px;
            margin-top: 10px;
        }
        
        .welcome-message h2 {
            color: #1a237e;
            margin-bottom: 10px;
        }
        
        .examples {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .example {
            background: white;
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .example:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
        }
        
        @media (max-width: 500px) {
            .container {
                height: 95vh;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .message {
                max-width: 90%;
            }
            
            .examples {
                grid-template-columns: 1fr;
            }
        }
        
        .app-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .app-icon i {
            font-size: 24px;
            color: white;
        }
        
        .equation {
            font-family: 'Courier New', monospace;
            background: #f5f5f5;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 3px 0;
        }
        
        .variable {
            color: #d35400;
            font-weight: bold;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .step-equation {
            margin: 10px 0;
            padding: 8px 12px;
            background: #f8f9fa;
            border-left: 3px solid #3a7bd5;
            border-radius: 0 5px 5px 0;
        }
        
        .keyboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
            padding: 10px;
            background: #f0f4f8;
            border-radius: 10px;
        }
        
        .key {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .key:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
        }
        
        .key.operator {
            background: #e3f2fd;
            color: #1a73e8;
        }
        
        .key.special {
            background: #ffecb3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gia Sư Toán AI <i class="fas fa-calculator"></i></h1>
            <p>Giải toán & tìm x từ mẫu giáo đến giáo sư</p>
            <div class="app-icon">
                <i class="fas fa-brain"></i>
            </div>
        </div>
        
        <div class="chat-container" id="chatContainer">
            <div class="welcome-message">
                <h2>Chào bạn! Tôi là gia sư Toán AI</h2>
                <p>Nhập phép tính hoặc phương trình tìm x, tôi sẽ giải thích chi tiết từng bước!</p>
                
                <div class="examples">
                    <div class="example" onclick="insertExample('15 + 7 × 3')">15 + 7 × 3</div>
                    <div class="example" onclick="insertExample('(4 + 5) × 2')">(4 + 5) × 2</div>
                    <div class="example" onclick="insertExample('2x + 5 = 15')">2x + 5 = 15</div>
                    <div class="example" onclick="insertExample('3(x - 4) = 21')">3(x - 4) = 21</div>
                </div>
            </div>
            
            <!-- Chat messages will be inserted here by JavaScript -->
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <div class="input-container">
            <input type="text" id="userInput" placeholder="Nhập phép tính hoặc phương trình (ví dụ: 2x + 5 = 15)" autocomplete="off">
            <button id="sendButton">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        
        <div class="keyboard">
            <div class="key" onclick="insertSymbol('x')">x</div>
            <div class="key" onclick="insertSymbol('(')">(</div>
            <div class="key" onclick="insertSymbol(')')">)</div>
            <div class="key operator" onclick="insertSymbol('+')">+</div>
            <div class="key operator" onclick="insertSymbol('-')">-</div>
            <div class="key operator" onclick="insertSymbol('×')">×</div>
            <div class="key operator" onclick="insertSymbol('÷')">÷</div>
            <div class="key" onclick="insertSymbol('²')">x²</div>
            <div class="key" onclick="insertSymbol('^')">^</div>
            <div class="key special" onclick="clearInput()">Xóa</div>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        
        // Focus input on load
        userInput.focus();
        
        // Insert example into input
        function insertExample(example) {
            userInput.value = example;
            userInput.focus();
        }
        
        // Insert symbol into input
        function insertSymbol(symbol) {
            userInput.value += symbol;
            userInput.focus();
        }
        
        // Clear input
        function clearInput() {
            userInput.value = '';
            userInput.focus();
        }
        
        // Send message when button clicked
        sendButton.addEventListener('click', sendMessage);
        
        // Send message when Enter pressed
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        function sendMessage() {
            const message = userInput.value.trim();
            if (message === '') return;
            
            // Add user message to chat
            addMessage(message, 'user');
            userInput.value = '';
            
            // Show typing indicator
            typingIndicator.style.display = 'flex';
            
            // Simulate AI thinking and then respond
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                let response;
                
                if (message.includes('=') && message.includes('x')) {
                    response = solveEquation(message);
                } else {
                    response = generateMathSolution(message);
                }
                
                addMessage(response, 'bot');
                
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 1500);
        }
        
        function addMessage(content, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(sender + '-message');
            
            if (sender === 'user') {
                messageElement.textContent = content;
            } else {
                messageElement.innerHTML = content;
            }
            
            chatContainer.appendChild(messageElement);
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function generateMathSolution(expression) {
            // Clean expression for calculation
            const cleanExpression = expression
                .replace(/×/g, '*')
                .replace(/÷/g, '/')
                .replace(/\^/g, '**')
                .replace(/²/g, '**2');
            
            let result;
            let level;
            
            try {
                // Calculate result
                result = eval(cleanExpression);
                
                // Determine difficulty level
                if (cleanExpression.includes('**') || cleanExpression.includes('/')) {
                    level = "Trung học cơ sở";
                } else if (cleanExpression.includes('*') || cleanExpression.includes('(')) {
                    level = "Tiểu học";
                } else {
                    level = "Mẫu giáo";
                }
            } catch (e) {
                return `<div class="solution-title"><i class="fas fa-exclamation-triangle"></i> Phép tính không hợp lệ</div>
                        <p>Xin lỗi, tôi không thể giải phép tính này. Vui lòng nhập một phép tính hợp lệ.</p>
                        <p>Ví dụ: 15 + 7 × 3, (4 + 5) × 2, 3/4 + 1/2, 2² × (10 - 5)</p>`;
            }
            
            // Generate detailed solution
            let solution = `<div class="solution-title"><i class="fas fa-lightbulb"></i> Lời giải chi tiết</div>`;
            
            // Step 1: Explain the expression
            solution += `<div class="solution-step">Chúng ta có phép tính: <span class="equation">${expression}</span></div>`;
            
            // Step 2: Explain order of operations
            if (expression.includes('(') || expression.includes('×') || expression.includes('+') || expression.includes('-')) {
                solution += `<div class="solution-step">Thực hiện theo thứ tự ưu tiên: ngoặc trước, sau đó nhân/chia, cuối cùng cộng/trừ</div>`;
            }
            
            // Step 3: Break down calculation
            if (expression.includes('(')) {
                const innerExpression = expression.match(/\((.*?)\)/)[1];
                solution += `<div class="solution-step">Tính biểu thức trong ngoặc trước: <span class="equation">${innerExpression} = ${eval(innerExpression.replace(/×/g, '*'))}</span></div>`;
            }
            
            if (expression.includes('×') || expression.includes('÷') || expression.includes('^') || expression.includes('²')) {
                solution += `<div class="solution-step">Thực hiện phép nhân/chia/lũy thừa trước: `;
                
                // Extract multiplication/division parts
                if (expression.includes('×')) {
                    const parts = expression.split('×');
                    solution += `<span class="equation">${parts[0]} × ${parts[1]} = ${eval(parts[0] + '*' + parts[1])}</span>`;
                } else if (expression.includes('÷')) {
                    const parts = expression.split('÷');
                    solution += `<span class="equation">${parts[0]} ÷ ${parts[1]} = ${eval(parts[0] + '/' + parts[1])}</span>`;
                } else if (expression.includes('^') || expression.includes('²')) {
                    const base = expression.match(/(\d+)(\^|\²)/)[1];
                    solution += `<span class="equation">${base}² = ${base * base}</span>`;
                }
                
                solution += `</div>`;
            }
            
            // Step 4: Final calculation
            solution += `<div class="solution-step">Thực hiện phép cộng/trừ: `;
            
            if (expression.includes('+')) {
                const parts = expression.split('+');
                solution += `<span class="equation">${parts[0]} + ${parts[1]} = ${result}</span>`;
            } else if (expression.includes('-')) {
                const parts = expression.split('-');
                solution += `<span class="equation">${parts[0]} - ${parts[1]} = ${result}</span>`;
            } else {
                solution += `Kết quả cuối cùng: <span class="equation">${result}</span>`;
            }
            
            solution += `</div>`;
            
            // Step 5: Show final result
            solution += `<div class="final-result">Kết quả: <span class="equation">${expression} = ${result}</span></div>`;
            
            // Add level indicator
            solution += `<div class="level-indicator">Độ khó: ${level}</div>`;
            
            return solution;
        }
        
        function solveEquation(equation) {
            // Normalize equation
            equation = equation.replace(/\s/g, '');
            
            // Check for invalid equation
            if (!equation.includes('=') || !equation.includes('x')) {
                return `<div class="solution-title"><i class="fas fa-exclamation-triangle"></i> Phương trình không hợp lệ</div>
                        <p>Vui lòng nhập phương trình có dạng: ax + b = c hoặc tương tự</p>
                        <p>Ví dụ: 2x + 5 = 15, 3(x - 4) = 21, x/2 = 8</p>`;
            }
            
            try {
                // Simple equation solving
                let solution = `<div class="solution-title"><i class="fas fa-search"></i> Giải phương trình: <span class="equation">${equation}</span></div>`;
              
                // Step 1: Write the original equation
                solution += `<div class="solution-step">Phương trình ban đầu: <span class="equation">${equation}</span></div>`;
                
                // Step 2: Simplify if needed
                if (equation.includes('(')) {
                    const simplified = equation.replace('(', '').replace(')', '');
                    solution += `<div class="solution-step">Bỏ ngoặc đơn: <span class="equation">${simplified}</span></div>`;
                    equation = simplified;
                }
                
                // Step 3: Move constants to the other side
                const [left, right] = equation.split('=');
                let leftSide = left;
                let rightSide = right;
                
                // Check if there's a constant on the left
                if (leftSide.match(/\d+$/) && !leftSide.match(/x$/)) {
                    const constant = leftSide.match(/(\d+)$/)[1];
                    solution += `<div class="solution-step">Chuyển hằng số ${constant} sang vế phải (đổi dấu):`;
                    solution += `<div class="step-equation">${leftSide} - ${constant} = ${rightSide} - ${constant}</div>`;
                    leftSide = leftSide.replace(constant, '');
                    rightSide = `(${rightSide} - ${constant})`;
                    solution += `<div class="step-equation">${leftSide} = ${rightSide}</div>`;
                    solution += `</div>`;
                }
                
                // Step 4: Isolate the variable
                if (leftSide.includes('x') && leftSide.match(/\d/)) {
                    const coefficient = leftSide.match(/(\d+)x/)[1];
                    solution += `<div class="solution-step">Chia cả hai vế cho hệ số ${coefficient}:`;
                    solution += `<div class="step-equation">${leftSide} / ${coefficient} = ${rightSide} / ${coefficient}</div>`;
                    leftSide = 'x';
                    rightSide = `(${rightSide} / ${coefficient})`;
                    solution += `<div class="step-equation">${leftSide} = ${rightSide}</div>`;
                    solution += `</div>`;
                }
                
                // Step 5: Calculate the result
                const result = eval(rightSide.replace(/x/g, '0'));
                solution += `<div class="solution-step">Tính giá trị vế phải: <span class="equation">${rightSide} = ${result}</span></div>`;
                
                // Step 6: Final result
                solution += `<div class="final-result">Kết luận: <span class="equation">x = ${result}</span></div>`;
                
                // Step 7: Verification
                solution += `<div class="solution-step">Kiểm tra kết quả:`;
                const verification = equation.replace(/x/g, result);
                solution += `<div class="step-equation">${verification}</div>`;
                solution += `</div>`;
                
                // Add level indicator
                solution += `<div class="level-indicator">Phương trình bậc nhất một ẩn</div>`;
                
                return solution;
            } catch (e) {
                return `<div class="solution-title"><i class="fas fa-exclamation-triangle"></i> Không thể giải phương trình</div>
                        <p>Xin lỗi, tôi không thể giải phương trình này. Vui lòng nhập phương trình đơn giản hơn.</p>
                        <p>Ví dụ: 2x + 5 = 15, 3(x - 4) = 21, x/2 = 8</p>`;
            }
        }
        
        // Add initial welcome message from bot
        setTimeout(() => {
            addMessage("Xin chào! Tôi là gia sư Toán AI. Hãy nhập bất kỳ phép tính nào hoặc phương trình tìm x, tôi sẽ giải thích chi tiết từng bước như một gia sư thực thụ!", 'bot');
        }, 1000);
    </script>
</body>
</html>
